<!-- File Size: 1.1KB Speed: 2.05s -->
<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Team Roster Page</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="classes.js"></script>

  </head>
  <body>
    <h1 class="text-center mx-auto">Team 1</h1>
    <ul class="nav nav-pills nav-justified border border-dark">  
      <li class="nav-item">
        <a class="nav-link active bg-info" href="#">Roster</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-info" href="teamschedule.html">Schedule</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-info" href="showstatsBS.html">Stats</a>
      </li>
    </ul>
    <br>
    <button type="button" class="button btn-info btn-block col-11 mx-auto" data-toggle="modal" data-target="#playerModal">+ Player</button>
    <br>
    <div class="modal fade" id="playerModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Player</h5>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <form class="form-horizontal" role="form" action="#" id="playerForm">
              <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Name">
              </div>
              <div class="form-group">
                <label for="num">Player Number</label>
                <input type="number" class="form-control" min=0 id="num">
              </div>
              <div class="form-group">
                <label for="dob">DOB</label>
                <input type="date" class="form-control" id="dob">
              </div>
              <div class="form-group">
                <label for="postion">Position</label>
                <select class="form-group" id="position">
                  <option value="Striker">Striker</option>
                  <option value="Forward">Forward</option>
                  <option value="Right Midfielder">Right Midfielder</option>
                  <option value="Center Midfielder">Center Midfielder</option>
                  <option value="Left Midfielder">Left Midfielder</option>
                  <option value="Right Back">Right Back</option>
                  <option value="Left Back">Left Back</option>
                  <option value="Center Back">Center Back</option>
                  <option value="Goal Keeper">Goal Keeper</option>
                </select>
              </div>
              <div class="form-group">
                <label for="imgLink">Player Image Link</label>
                <!-- FOR LATER: update to save image files
                <input type="file" name="playerImg" accept="image/*" id="playerImg">
                -->
                <input type="text" id="imgLink">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary btn-info" data-dismiss="modal" id="save">Save</button> 
          </div>
        </div>
      </div>
    </div>

    <div id="playerList">

    </div>

    <template id="playerRow">
      <div class="row" id="temp">
        <div class="col-4 text-center">
          <img src="http://primitivedesigns.co.uk/squarepegscoaching.com/wp-content/uploads/2017/03/Avatar-1.png" alt="profile image" class="img-responsive w-75" id="image">
        </div>
        <div class="col-7 bg-info">
          <div class="row">
            <div class="col-9 text-white">
              <h2>Name</h2>
              <h6>DOB: </h6> 
              <h6>Position:</h6>
              <h6>ID:</h6>
            </div>
            <div class="col-3">
              <div class="row h-50 justify-content-center">
                <button type="button" class="btn btn-light h-50 mt-4" data-toggle="modal" data-target="#editModal" id="edit">
                  <i class="fa fa-pencil" aria-hidden="true"></i>
                </button>
              </div>
              <div class="row h-50 justify-content-center">
                <button type="button" class="btn btn-light h-50" id="remove">
                  <i class="fa fa-trash-o" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <br>
    </template>

    <div class="modal fade" id="editModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Player</h5>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <form class="form-horizontal" role="form" action="#" id="playerForm">
              <div class="form-group">
                <label for="oldName">Name</label>
                <input type="text" class="form-control" id="oldName" placeholder="Name">
              </div>
              <div class="form-group">
                <label for="oldNum">Player Number</label>
                <input type="number" class="form-control" min=0 id="oldNum">
              </div>
              <div class="form-group">
                <label for="oldDob">DOB</label>
                <input type="date" class="form-control" id="oldDob">
              </div>
              <div class="form-group">
                <label for="oldPos">Position</label>
                <select class="form-group" id="oldPos">
                  <option value="Striker">Striker</option>
                  <option value="Forward">Forward</option>
                  <option value="Right Midfielder">Right Midfielder</option>
                  <option value="Center Midfielder">Center Midfielder</option>
                  <option value="Left Midfielder">Left Midfielder</option>
                  <option value="Right Back">Right Back</option>
                  <option value="Left Back">Left Back</option>
                  <option value="Center Back">Center Back</option>
                  <option value="Goal Keeper">Goal Keeper</option>
                </select>
              </div>
              <div class="form-group">
                <label for="oldLink">Player Image Link</label>
                <input type="text" id="oldLink">
                <!-- FOR LATER: update to save image files
                <input type="file" name="playerImg" accept="image/*" id="oldImg">
                -->
              </div>
              <div class="form-group">
                <input type="hidden" id="key">
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary btn-info" data-dismiss="modal" id="update">Save</button> 
          </div>
        </div>
      </div>
    </div>

    
    <br>
    <script>
      /*class Player {
        constructor(name, num, dob, position) {
          this.name = name;
          this.num = num;
          this.dob = dob;
          this.position = position;
          this.img;
        }
      }*/

      document.getElementById("save").addEventListener("click",function(){
        var name = document.getElementById("name").value;
        var num = document.getElementById("num").value;
        var dob = document.getElementById("dob").value;
        var position = document.getElementById("position").value;
        var image = document.getElementById("imgLink").value;
        var img;
        if(image) {
          img = image;
        }

        if(name == "" || num == "" || dob == "" || position == ""){
          alert("Please enter all fields");
        }
        else{
          let p = new Player(name,num,dob,position);
          var playersItem = localStorage.getItem("players");
          var playersArr;
          if(img){
            p.img = img;
          }
          if (!playersItem){
            playersArr = [];
          } else {
            playersArr = JSON.parse(playersItem);
          }
          playersArr.push(p);

          localStorage.setItem("players",JSON.stringify(playersArr));
          for (var key in playersArr){
            console.log(JSON.stringify(playersArr[key]));
          }
          $('#playerModal').modal('hide');
          window.location.reload();
        }
      });

      window.addEventListener('DOMContentLoaded', function() {
        let playersItem = localStorage.getItem("players");
        let playersArr = JSON.parse(playersItem);
        var markup = "";
        var playerList = document.querySelector("#playerList");
        let t = document.querySelector('#playerRow');
        var h2 = t.content.querySelector('h2');
        var h6 = t.content.querySelectorAll('h6');
        var image = t.content.querySelector('img');
        for (var key in playersArr){
          let player = playersArr[key];
          var a = String(key);
          h2.innerHTML = player["name"] + " #" + player["num"];
          console.log("h2.innerHTML: " + h2.innerHTML);
          h6[0].innerHTML = "DOB: " + player["dob"];
          h6[1].innerHTML = "Position: " + player["position"];
          h6[2].innerHTML = "ID: " + (++key);
          if(player.img){
            image.src = player.img;
          }
          else {
            image.src = "http://primitivedesigns.co.uk/squarepegscoaching.com/wp-content/uploads/2017/03/Avatar-1.png";
          }
          t.content.querySelector("#remove").setAttribute('onclick', "deletePlayer("+a+");");
          t.content.querySelector("#edit").setAttribute('onclick', "editPlayer(\""+a+"\");");
          var clone = document.importNode(t.content, true);
          playerList.appendChild(clone);
        }
      });

      function deletePlayer(key) {
        console.log("deleting: " + key);
        let playersItem = localStorage.getItem("players");
        console.log("Before " + playersItem);
        let playersArr = JSON.parse(playersItem);
        localStorage.removeItem(key);
        playersArr.splice(key,1);
        console.log("After " + JSON.stringify(playersArr));
        localStorage.setItem("players", JSON.stringify(playersArr));
        window.location.reload();
      }

      function editPlayer(key) {
        let playersItem = localStorage.getItem("players");
        let playersArr = JSON.parse(playersItem);
        let player = playersArr[key];

        var oldName = player.name;
        var oldNum = player.num;
        var oldDob = player.dob;
        var oldPos = player.position;

        document.getElementById("oldName").value = oldName;
        document.getElementById("oldNum").value = oldNum;
        document.getElementById("oldDob").value = oldDob;
        document.getElementById("oldPos").value = oldPos;
        document.getElementById("key").value = key;
      }

      document.getElementById("update").addEventListener("click",function(){
        var name = document.getElementById("oldName").value;
        var num = document.getElementById("oldNum").value;
        var dob = document.getElementById("oldDob").value;
        var position = document.getElementById("oldPos").value;
        var image = document.getElementById("oldLink").value;
        var key = document.getElementById("key").value;


        if(name == "" || num == "" || dob == "" || position == ""){
          alert("Please enter all fields");
        }
        else{
          var playersItem = localStorage.getItem("players");
          var playersArr = JSON.parse(playersItem);
          var p = playersArr[key];
          
          p.name = name;
          p.num = num;
          p.dob = dob;
          p.position = position;

          if(image){
            p.img = image;
          }

          localStorage.setItem("players",JSON.stringify(playersArr));
          
          $('#editModal').modal('hide');
          window.location.reload();
        }
      });


    </script>

    <p><a href="https://validator.w3.org/nu/?doc=https%3A%2F%2Fteamsnipelk.firebaseapp.com%2Fteamroster.html">W3 Validator</a></p>
  </body>

</html>